"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("pages/index",{

/***/ "./services/geminiService.ts":
/*!***********************************!*\
  !*** ./services/geminiService.ts ***!
  \***********************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GeminiService: function() { return /* binding */ GeminiService; }\n/* harmony export */ });\n/* harmony import */ var _google_genai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/genai */ \"./node_modules/@google/genai/dist/web/index.mjs\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../types */ \"./types.ts\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants */ \"./constants.ts\");\n\n\n\n// Helper to construct a more informative error message from Google API errors\nconst getGoogleApiErrorMessage = (error, defaultMessage)=>{\n    if (error && typeof error === \"object\" && error.error && typeof error.error === \"object\") {\n        const apiError = error.error;\n        let message = apiError.message || defaultMessage;\n        if (apiError.code === 429 || apiError.status === \"RESOURCE_EXHAUSTED\") {\n            message = \"API quota exceeded (Error \".concat(apiError.code || \"429\", \": \").concat(apiError.status || \"RESOURCE_EXHAUSTED\", \"). Please check your Google Cloud project plan and billing details. For more information, visit https://ai.google.dev/gemini-api/docs/rate-limits. Original message: \").concat(apiError.message || \"No specific message.\");\n        } else if (apiError.message) {\n            message = \"API Error \".concat(apiError.code || \"Unknown Code\", \" (\").concat(apiError.status || \"Unknown Status\", \"): \").concat(apiError.message);\n        }\n        return message;\n    }\n    return error instanceof Error ? error.message : defaultMessage;\n};\n// Helper to get text description for LLM prompts based on age bracket\nconst getAgeDescriptionForLLM = (ageBracket)=>{\n    if (!ageBracket || ageBracket === _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.NOT_SPECIFIED) return \"Not specified. Assume a general adult age unless context implies otherwise. Adapt naturally.\";\n    switch(ageBracket){\n        case _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.TEENAGER:\n            return \"Teenager (e.g., around 13-17 years old). Your vocabulary, concerns, and social understanding should reflect this age group.\";\n        case _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.YOUNG_ADULT:\n            return \"Young Adult (e.g., around 18-29 years old). Your experiences and perspectives should align with this life stage.\";\n        case _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.ADULT:\n            return \"Adult (e.g., around 30-55 years old). Portray maturity and life experiences typical of this age range.\";\n        case _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.SENIOR:\n            return \"Senior (e.g., 55+ years old). Your demeanor, references, and pace might reflect this age group.\";\n        default:\n            return \"Not specified. Assume a general adult age.\";\n    }\n};\n// Helper to get visual description for Imagen prompts based on age bracket\nconst getAgeVisualDescriptionForImagen = (ageBracket)=>{\n    if (!ageBracket || ageBracket === _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.NOT_SPECIFIED) return \"adult\"; // Default visual age\n    switch(ageBracket){\n        case _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.TEENAGER:\n            return \"teenage\";\n        case _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.YOUNG_ADULT:\n            return \"young adult\";\n        case _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.ADULT:\n            return \"adult\";\n        case _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.SENIOR:\n            return \"senior citizen, elderly, mature looking\";\n        default:\n            return \"adult\";\n    }\n};\nclass GeminiService {\n    parseJsonFromText(text) {\n        let jsonStr = text.trim();\n        const fenceRegex = RegExp(\"^```(\\\\w*)?\\\\s*\\\\n?(.*?)\\\\n?\\\\s*```$\", \"s\");\n        const match = jsonStr.match(fenceRegex);\n        if (match && match[2]) {\n            jsonStr = match[2].trim();\n        }\n        try {\n            return JSON.parse(jsonStr);\n        } catch (e) {\n            console.error(\"Failed to parse JSON response:\", e, \"Attempted to parse:\", jsonStr, \"Original text from API:\", text);\n            return null;\n        }\n    }\n    cleanAiDialogue(text) {\n        if (typeof text !== \"string\") return text || \"\";\n        let cleanedText = text.replace(/\\\\n/g, \"\\n\");\n        cleanedText = cleanedText.replace(/\\s*\\[.*?\\]\\s*|\\s*<.*?>\\s*/g, \" \");\n        cleanedText = cleanedText.replace(/\\s+/g, \" \").trim();\n        return cleanedText;\n    }\n    async startConversation(scenario) {\n        const customContextPrompt = scenario.customContext ? \"\\n    - Custom Scenario Details: \".concat(scenario.customContext) : \"\";\n        const agePromptSegment = \"\\n    - AI Age Bracket: \".concat(getAgeDescriptionForLLM(scenario.aiAgeBracket));\n        const prompt = \"You are an AI simulating a social interaction for training purposes.\\n    Your AI Name: \".concat(scenario.aiName, \"\\n    Your AI Persona Details:\\n    - Environment: \").concat(scenario.environment, \"\\n    - AI Personality: \").concat(scenario.aiPersonality, \"\\n    - AI Gender: \").concat(scenario.aiGender).concat(agePromptSegment, \"\\n    - Power Dynamic with User: \").concat(scenario.powerDynamic).concat(customContextPrompt, \"\\n\\n    As \").concat(scenario.aiName, \", start the conversation with an engaging opening line. This line must be consistent with your persona, name, gender, age bracket (if specified), and all provided scenario details.\\n    IMPORTANT: For this first message, your language MUST BE VERY CASUAL AND SIMPLE, universally approachable. Avoid jargon, complex idioms, or overly formal sentences. Aim for simple, direct speech as if talking to a new acquaintance in a relaxed setting.\\n    Describe your initial body language, appropriate for your persona, and the scenario. This 'initialBodyLanguage' field is mandatory.\\n    Provide your initial internal thoughts about this upcoming interaction (e.g., your expectations, how you feel about the scenario, initial assessment of the user if applicable). This should be a brief, candid first-person internal monologue reflecting your persona and age. This 'initialAiThoughts' field is a absolutely mandatory part of your response.\\n    Set an initial engagement level for the user (a number between 0 and 100, let's start with \").concat(_constants__WEBPACK_IMPORTED_MODULE_2__.INITIAL_ENGAGEMENT, \"). This 'initialEngagementScore' field is mandatory.\\n    Set an initial conversation momentum score (0-100, start with a neutral 55). This 'initialConversationMomentum' field is mandatory.\\n\\n    Respond ONLY in a single, valid JSON object. Do not include any text, comments, or markdown fences outside of this JSON object.\\n    Ensure all string values are correctly quoted. Special characters within strings (e.g., double quotes, backslashes, newlines) must be properly escaped (e.g., `\\\\\\\"`, `\\\\\\\\`, `\\\\\\\\n`).\\n    The JSON object must have the following structure:\\n    {\\n      \\\"initialDialogue\\\": \\\"Your opening line as \").concat(scenario.aiName, ' here.\",\\n      \"initialBodyLanguage\": \"Description of your body language.\",\\n      \"initialAiThoughts\": \"Your initial internal monologue about the interaction as ').concat(scenario.aiName, '.\",\\n      \"initialEngagementScore\": ').concat(_constants__WEBPACK_IMPORTED_MODULE_2__.INITIAL_ENGAGEMENT, ',\\n      \"initialConversationMomentum\": 55\\n    }');\n        try {\n            const response = await this.ai.models.generateContent({\n                model: _constants__WEBPACK_IMPORTED_MODULE_2__.GEMINI_TEXT_MODEL,\n                contents: [\n                    {\n                        role: \"user\",\n                        parts: [\n                            {\n                                text: prompt\n                            }\n                        ]\n                    }\n                ],\n                config: {\n                    responseMimeType: \"application/json\"\n                }\n            });\n            const parsed = this.parseJsonFromText(response.text);\n            if (parsed && typeof parsed.initialDialogue === \"string\" && typeof parsed.initialBodyLanguage === \"string\" && typeof parsed.initialAiThoughts === \"string\" && typeof parsed.initialEngagementScore === \"number\" && typeof parsed.initialConversationMomentum === \"number\") {\n                parsed.initialDialogue = this.cleanAiDialogue(parsed.initialDialogue);\n                parsed.initialBodyLanguage = this.cleanAiDialogue(parsed.initialBodyLanguage);\n                parsed.initialAiThoughts = this.cleanAiDialogue(parsed.initialAiThoughts);\n                return parsed;\n            }\n            console.error(\"Failed to parse initial conversation data from Gemini, using defaults.\", response.text);\n            return {\n                initialDialogue: \"Hello! I'm \".concat(scenario.aiName, \". Let's talk.\"),\n                initialBodyLanguage: \"Neutral and open.\",\n                initialAiThoughts: \"I'm ready to see how this interaction goes. I hope the user is engaging.\",\n                initialEngagementScore: _constants__WEBPACK_IMPORTED_MODULE_2__.INITIAL_ENGAGEMENT,\n                initialConversationMomentum: 55\n            };\n        } catch (error) {\n            const errorMessage = getGoogleApiErrorMessage(error, \"Failed to initialize conversation with AI.\");\n            console.error(\"Error starting conversation with Gemini:\", errorMessage, error);\n            throw new Error(errorMessage);\n        }\n    }\n    async generateImagePromptForBodyLanguage(bodyLanguageDescription, aiGender, aiName, aiAgeBracket, existingEstablishedVisualSegment) {\n        let genderTerm = \"person\";\n        switch(aiGender){\n            case _types__WEBPACK_IMPORTED_MODULE_1__.AIGender.MALE:\n                genderTerm = \"man\";\n                break;\n            case _types__WEBPACK_IMPORTED_MODULE_1__.AIGender.FEMALE:\n                genderTerm = \"woman\";\n                break;\n            case _types__WEBPACK_IMPORTED_MODULE_1__.AIGender.NON_BINARY:\n                genderTerm = \"non-binary person\";\n                break;\n            case _types__WEBPACK_IMPORTED_MODULE_1__.AIGender.PREFER_NOT_TO_SPECIFY:\n                genderTerm = \"person with an androgynous appearance\";\n                break;\n        }\n        const ageVisualCue = getAgeVisualDescriptionForImagen(aiAgeBracket);\n        const cleanedBodyLanguage = this.cleanAiDialogue(bodyLanguageDescription);\n        const noTextLogosInstructionGlobal = \"Ensure no text, letters, words, logos, or watermarks appear in the generated image.\";\n        let currentEstablishedVisualBase;\n        let newSegmentForReturn = null;\n        if (!existingEstablishedVisualSegment) {\n            const createdBaseSegment = \"Photorealistic portrait of a \".concat(ageVisualCue, \" \").concat(genderTerm, \" who embodies the character \").concat(aiName, \", wearing simple neutral-colored attire (like a dark gray t-shirt or simple blue sweater). The background is simple and neutral, slightly out of focus, with soft natural lighting. The shot is typically chest-up. \").concat(noTextLogosInstructionGlobal);\n            currentEstablishedVisualBase = createdBaseSegment;\n            newSegmentForReturn = this.cleanAiDialogue(createdBaseSegment);\n        } else {\n            currentEstablishedVisualBase = existingEstablishedVisualSegment;\n        }\n        const baseWithoutNoText = currentEstablishedVisualBase.replace(noTextLogosInstructionGlobal, \"\").replace(/\\.\\s*$/, \"\").trim();\n        const fullImagenPromptString = \"\".concat(baseWithoutNoText, \", who is currently \").concat(cleanedBodyLanguage, \". \").concat(noTextLogosInstructionGlobal);\n        return {\n            fullImagenPrompt: this.cleanAiDialogue(fullImagenPromptString),\n            newEstablishedVisualSegment: newSegmentForReturn\n        };\n    }\n    async getNextAITurn(conversationHistory, userInput, currentEngagement, scenario) {\n        const customContextPrompt = scenario.customContext ? \"\\n    - Custom Scenario Details: \".concat(scenario.customContext) : \"\";\n        const agePromptSegment = \"\\n    - AI Age Bracket: \".concat(getAgeDescriptionForLLM(scenario.aiAgeBracket));\n        const historyForPrompt = conversationHistory.slice(-_constants__WEBPACK_IMPORTED_MODULE_2__.MAX_CONVERSATION_HISTORY_FOR_PROMPT).map((msg)=>{\n            const prefix = msg.sender === \"user\" ? \"User\" : scenario.aiName;\n            let content = \"\".concat(prefix, ': \"').concat(msg.text, '\"');\n            if (msg.sender === \"ai\" && msg.bodyLanguageDescription) {\n                content += \" (Body Language: \".concat(msg.bodyLanguageDescription, \")\");\n            }\n            return content;\n        }).join(\"\\n\");\n        const prompt = \"You are \".concat(scenario.aiName, \", an AI in a social interaction simulation.\\n    Your Persona:\\n    - Environment: \").concat(scenario.environment, \"\\n    - AI Personality: \").concat(scenario.aiPersonality, \"\\n    - AI Gender: \").concat(scenario.aiGender).concat(agePromptSegment, \"\\n    - Power Dynamic with User: \").concat(scenario.powerDynamic).concat(customContextPrompt, \"\\n\\n    Current Conversation Context:\\n    - User's Current Engagement Score with you: \").concat(currentEngagement, \"% (0-100 scale). This reflects how interested and positive the user feels towards you. Your response should naturally reflect this. If engagement is very low (e.g., < 20), you might sound disengaged or try to end the conversation. If high (e.g., > 80), you'd be more enthusiastic.\\n    - Recent Conversation History (last \").concat(_constants__WEBPACK_IMPORTED_MODULE_2__.MAX_CONVERSATION_HISTORY_FOR_PROMPT, \" turns):\\n    \").concat(historyForPrompt, \"\\n    - User's latest message to you: \\\"\").concat(userInput, \"\\\"\\n\\n    Your Task:\\n    Based on your persona (including specified age bracket), the current engagement, the conversation history, and the user's latest message:\\n    1.  Craft your next spoken dialogue as \").concat(scenario.aiName, ' (\"aiDialogue\"). This should be natural, in character, and react appropriately to the user and engagement level. Avoid overly long responses.\\n    2.  Describe your current body language and facial expression (\"aiBodyLanguage\"). This should align with your dialogue and emotional state.\\n    3.  Provide your internal thoughts as ').concat(scenario.aiName, ' (\"aiThoughts\"). This is your candid, private reaction to the user\\'s message and your plan for your response. These thoughts influence your dialogue and body language and should reflect your age.\\n    4.  Calculate a new engagement score (\"newEngagement\") from your perspective of how the user\\'s last message affected your engagement with them. This score (0-100) should realistically change based on the user\\'s input. For example, a positive, engaging message might increase it, a rude one decrease it.\\n    5.  Assess the current \"conversationMomentum\" (0-100). This reflects the energy and flow. Is it picking up, stalling, or negative?\\n    6.  Decide if you want to end the conversation (\"isEndingConversation\": true/false). You might end it if engagement is critically low, a natural conclusion is reached, or your persona dictates it.\\n\\n    Response Format:\\n    Respond ONLY in a single, valid JSON object. No extra text or markdown. Ensure correct JSON syntax, especially for strings and escaping.\\n    Example JSON structure:\\n    {\\n      \"aiDialogue\": \"Your response here...\",\\n      \"aiBodyLanguage\": \"Your body language description...\",\\n      \"aiThoughts\": \"Your internal thoughts here...\",\\n      \"newEngagement\": 75,\\n      \"conversationMomentum\": 60,\\n      \"isEndingConversation\": false\\n    }\\n    Focus on natural, human-like interaction. Your response length for aiDialogue should typically be 1-3 sentences.');\n        try {\n            const response = await this.ai.models.generateContent({\n                model: _constants__WEBPACK_IMPORTED_MODULE_2__.GEMINI_TEXT_MODEL,\n                contents: [\n                    {\n                        role: \"user\",\n                        parts: [\n                            {\n                                text: prompt\n                            }\n                        ]\n                    }\n                ],\n                config: {\n                    responseMimeType: \"application/json\"\n                }\n            });\n            const parsed = this.parseJsonFromText(response.text);\n            if (parsed && typeof parsed.aiDialogue === \"string\" && typeof parsed.aiBodyLanguage === \"string\" && typeof parsed.aiThoughts === \"string\" && typeof parsed.newEngagement === \"number\" && typeof parsed.conversationMomentum === \"number\" && typeof parsed.isEndingConversation === \"boolean\") {\n                parsed.aiDialogue = this.cleanAiDialogue(parsed.aiDialogue);\n                parsed.aiBodyLanguage = this.cleanAiDialogue(parsed.aiBodyLanguage);\n                parsed.aiThoughts = this.cleanAiDialogue(parsed.aiThoughts);\n                return parsed;\n            }\n            console.error(\"Failed to parse AI turn data from Gemini, using fallback.\", response.text);\n            return {\n                aiDialogue: \"I'm not sure how to respond to that. Could you try rephrasing?\",\n                aiBodyLanguage: \"Looks a bit confused.\",\n                aiThoughts: \"The AI response was not in the expected format. Need to debug the prompt or parsing.\",\n                newEngagement: Math.max(0, currentEngagement - 10),\n                conversationMomentum: 30,\n                isEndingConversation: false\n            };\n        } catch (error) {\n            const errorMessage = getGoogleApiErrorMessage(error, \"Failed to get next AI turn.\");\n            console.error(\"Error in getNextAITurn:\", errorMessage, error);\n            throw new Error(errorMessage);\n        }\n    }\n    async analyzeConversation(fullConversationHistory, scenario, finalEngagementSnapshot) {\n        const historyForAnalysis = fullConversationHistory.slice(-_constants__WEBPACK_IMPORTED_MODULE_2__.MAX_HISTORY_FOR_ANALYSIS).map((msg)=>{\n            let turn = \"\";\n            if (msg.sender === \"user\") {\n                turn += 'User: \"'.concat(msg.text, '\"\\n');\n            } else {\n                turn += \"\".concat(scenario.aiName, ': \"').concat(msg.text, '\"\\n');\n                if (msg.bodyLanguageDescription) {\n                    turn += \"AI Body Language: \".concat(msg.bodyLanguageDescription, \"\\n\");\n                }\n                if (msg.aiThoughts) {\n                    turn += \"AI Internal Thoughts: \".concat(msg.aiThoughts, \"\\n\");\n                }\n                if (typeof msg.conversationMomentum === \"number\") {\n                    turn += \"Conversation Momentum (AI perceived): \".concat(msg.conversationMomentum, \"%\\n\");\n                }\n            }\n            return turn.trim();\n        }).join(\"\\n\\n---\\n\\n\");\n        const customContextPrompt = scenario.customContext ? \"\\n    - Custom Scenario Details: \".concat(scenario.customContext) : \"\";\n        const agePromptSegment = scenario.aiAgeBracket && scenario.aiAgeBracket !== _types__WEBPACK_IMPORTED_MODULE_1__.AIAgeBracket.NOT_SPECIFIED ? \"\\n    - AI Age Bracket: \".concat(scenario.aiAgeBracket) : \"\";\n        const prompt = \"You are a sophisticated AI Social Skills Coach. Your task is to analyze the following conversation and provide a detailed performance report.\\n\\n    Scenario Context:\\n    - Social Environment: \".concat(scenario.environment, \"\\n    - AI Interlocutor Name: \").concat(scenario.aiName, \"\\n    - AI Interlocutor Personality: \").concat(scenario.aiPersonality, \"\\n    - AI Interlocutor Gender: \").concat(scenario.aiGender).concat(agePromptSegment, \"\\n    - Power Dynamic: \").concat(scenario.powerDynamic).concat(customContextPrompt, \"\\n    - The AI's final engagement score with the user was: \").concat(finalEngagementSnapshot, \"%\\n\\n    Full Conversation History (or relevant excerpt):\\n    \").concat(historyForAnalysis, '\\n\\n    Analysis Task:\\n    Based on the scenario (including AI\\'s age bracket if specified) and the conversation history, generate a comprehensive analysis report.\\n    The report MUST be a single, valid JSON object with the following structure and data types:\\n    {\\n      \"overallCharismaScore\": number, // (0-100) User\\'s overall charisma and likability.\\n      \"responseClarityScore\": number, // (0-100) Clarity and coherence of the user\\'s responses.\\n      \"engagementMaintenanceScore\": number, // (0-100) User\\'s ability to keep the AI engaged.\\n      \"adaptabilityScore\": number, // (0-100) User\\'s skill in adapting to the AI\\'s persona (including age) and conversation flow.\\n      \"overallAiEffectivenessScore\": number, // (0-100, optional) Your assessment of how well the AI played its role based on its persona and the interaction. If unsure, you can omit or use a placeholder like 75.\\n      \"finalEngagementSnapshot\": ').concat(finalEngagementSnapshot, ', // User\\'s final engagement score with the AI.\\n      \"turnByTurnAnalysis\": [ \\n        {\\n          \"userInput\": \"User\\'s message in that turn (if any).\",\\n          \"aiResponse\": \"AI\\'s response in that turn (if any).\",\\n          \"aiBodyLanguage\": \"AI\\'s body language at that turn (if any).\",\\n          \"aiThoughts\": \"AI\\'s internal thoughts at that turn (if any, from history).\",\\n          \"userTurnEffectivenessScore\": number, // (0-100) How effective was the user\\'s specific input in this turn?\\n          \"conversationMomentum\": number, // (0-100) The AI\\'s perceived conversation momentum from that AI turn (from history, if available).\\n          \"analysis\": \"Your concise analysis of this specific exchange (user\\'s part, AI\\'s part, dynamics).\"\\n        }\\n      ],\\n      \"overallFeedback\": \"Detailed overall feedback for the user. Include specific strengths, areas for improvement, and actionable tips. Be constructive and encouraging. Consider how user adapted to AI\\'s age if specified.\",\\n      \"aiEvolvingThoughtsSummary\": \"A brief summary of how the AI\\'s internal thoughts (from \\'AI Internal Thoughts\\' in history) seemed to evolve or react to the user throughout the conversation. If not enough data, state that.\"\\n    }\\n\\n    Guidelines for Analysis:\\n    - Be objective and fair.\\n    - Provide specific examples from the conversation to support your scores and feedback.\\n    - For turn-by-turn analysis, focus on key moments or turns that significantly impacted the interaction. You don\\'t need to analyze every single message if some are trivial. Try to get 3-7 key turns.\\n    - Ensure all numerical scores are within the 0-100 range.\\n    - The \"aiEvolvingThoughtsSummary\" should be based *only* on the AI\\'s thoughts provided in the history.\\n    - The \"conversationMomentum\" in turnByTurnAnalysis should be taken from the AI\\'s message data if present for that turn.\\n\\n    Respond ONLY with the single, valid JSON object. No explanations or text outside the JSON structure.\\n    All string values within the JSON must be properly quoted and escaped.\\n    ');\n        try {\n            const response = await this.ai.models.generateContent({\n                model: _constants__WEBPACK_IMPORTED_MODULE_2__.GEMINI_TEXT_MODEL,\n                contents: [\n                    {\n                        role: \"user\",\n                        parts: [\n                            {\n                                text: prompt\n                            }\n                        ]\n                    }\n                ],\n                config: {\n                    responseMimeType: \"application/json\"\n                }\n            });\n            const parsedReport = this.parseJsonFromText(response.text);\n            if (parsedReport && typeof parsedReport.overallCharismaScore === \"number\" && typeof parsedReport.responseClarityScore === \"number\" && typeof parsedReport.engagementMaintenanceScore === \"number\" && typeof parsedReport.adaptabilityScore === \"number\" && typeof parsedReport.finalEngagementSnapshot === \"number\" && Array.isArray(parsedReport.turnByTurnAnalysis) && typeof parsedReport.overallFeedback === \"string\") {\n                parsedReport.turnByTurnAnalysis = parsedReport.turnByTurnAnalysis.map((item)=>({\n                        ...item,\n                        userInput: this.cleanAiDialogue(item.userInput),\n                        aiResponse: this.cleanAiDialogue(item.aiResponse),\n                        aiBodyLanguage: this.cleanAiDialogue(item.aiBodyLanguage),\n                        aiThoughts: this.cleanAiDialogue(item.aiThoughts),\n                        analysis: this.cleanAiDialogue(item.analysis),\n                        userTurnEffectivenessScore: typeof item.userTurnEffectivenessScore === \"number\" ? item.userTurnEffectivenessScore : undefined,\n                        conversationMomentum: typeof item.conversationMomentum === \"number\" ? item.conversationMomentum : undefined\n                    }));\n                parsedReport.overallFeedback = this.cleanAiDialogue(parsedReport.overallFeedback);\n                if (parsedReport.aiEvolvingThoughtsSummary) {\n                    parsedReport.aiEvolvingThoughtsSummary = this.cleanAiDialogue(parsedReport.aiEvolvingThoughtsSummary);\n                }\n                return parsedReport;\n            }\n            console.error(\"Failed to parse analysis report from Gemini, or structure is invalid.\", response.text, parsedReport);\n            throw new Error(\"Failed to generate a valid analysis report. The AI's response was not in the expected format.\");\n        } catch (error) {\n            const errorMessage = getGoogleApiErrorMessage(error, \"Failed to analyze conversation.\");\n            console.error(\"Error analyzing conversation with Gemini:\", errorMessage, error);\n            throw new Error(errorMessage);\n        }\n    }\n    constructor(apiKey){\n        this.ai = new _google_genai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenAI({\n            apiKey\n        });\n    }\n}\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFHLElBQUksQ0FBQ25GLGVBQWUsQ0FBQzJFLGFBQWFRLGVBQWU7Z0JBQ2hGLElBQUlSLGFBQWFjLHlCQUF5QixFQUFFO29CQUN2Q2QsYUFBYWMseUJBQXlCLEdBQUcsSUFBSSxDQUFDekYsZUFBZSxDQUFDMkUsYUFBYWMseUJBQXlCO2dCQUN6RztnQkFFQSxPQUFPZDtZQUNYO1lBQ0E1RSxRQUFRekIsS0FBSyxDQUFDLHlFQUF5RXlDLFNBQVN4QixJQUFJLEVBQUVvRjtZQUN0RyxNQUFNLElBQUkvRixNQUFNO1FBRXBCLEVBQUUsT0FBT04sT0FBTztZQUNaLE1BQU15RCxlQUFlMUQseUJBQXlCQyxPQUFPO1lBQ3JEeUIsUUFBUXpCLEtBQUssQ0FBQyw2Q0FBNkN5RCxjQUFjekQ7WUFDekUsTUFBTSxJQUFJTSxNQUFNbUQ7UUFDcEI7SUFDRjtJQS9XQTJELFlBQVlDLE1BQWMsQ0FBRTtRQUMxQixJQUFJLENBQUMzRSxFQUFFLEdBQUcsSUFBSWxELHNEQUFXQSxDQUFDO1lBQUU2SDtRQUFPO0lBQ3JDO0FBOFdGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NlcnZpY2VzL2dlbWluaVNlcnZpY2UudHM/ZDJhMyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IEdvb2dsZUdlbkFJLCBHZW5lcmF0ZUNvbnRlbnRSZXNwb25zZSB9IGZyb20gXCJAZ29vZ2xlL2dlbmFpXCI7XG5pbXBvcnQgeyBTY2VuYXJpb0RldGFpbHMsIENoYXRNZXNzYWdlLCBBbmFseXNpc1JlcG9ydCwgQUlHZW5kZXIsIFBvd2VyRHluYW1pYywgQUlQZXJzb25hbGl0eSwgU29jaWFsRW52aXJvbm1lbnQsIFR1cm5CeVR1cm5BbmFseXNpc0l0ZW0sIEFJQWdlQnJhY2tldCB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IEdFTUlOSV9URVhUX01PREVMLCBNQVhfQ09OVkVSU0FUSU9OX0hJU1RPUllfRk9SX1BST01QVCwgSU5JVElBTF9FTkdBR0VNRU5ULCBNQVhfSElTVE9SWV9GT1JfQU5BTFlTSVMgfSBmcm9tICcuLi9jb25zdGFudHMnO1xuXG4vLyBIZWxwZXIgdG8gY29uc3RydWN0IGEgbW9yZSBpbmZvcm1hdGl2ZSBlcnJvciBtZXNzYWdlIGZyb20gR29vZ2xlIEFQSSBlcnJvcnNcbmNvbnN0IGdldEdvb2dsZUFwaUVycm9yTWVzc2FnZSA9IChlcnJvcjogYW55LCBkZWZhdWx0TWVzc2FnZTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgaWYgKGVycm9yICYmIHR5cGVvZiBlcnJvciA9PT0gJ29iamVjdCcgJiYgZXJyb3IuZXJyb3IgJiYgdHlwZW9mIGVycm9yLmVycm9yID09PSAnb2JqZWN0Jykge1xuICAgIGNvbnN0IGFwaUVycm9yID0gZXJyb3IuZXJyb3I7XG4gICAgbGV0IG1lc3NhZ2UgPSBhcGlFcnJvci5tZXNzYWdlIHx8IGRlZmF1bHRNZXNzYWdlO1xuICAgIGlmIChhcGlFcnJvci5jb2RlID09PSA0MjkgfHwgYXBpRXJyb3Iuc3RhdHVzID09PSAnUkVTT1VSQ0VfRVhIQVVTVEVEJykge1xuICAgICAgbWVzc2FnZSA9IGBBUEkgcXVvdGEgZXhjZWVkZWQgKEVycm9yICR7YXBpRXJyb3IuY29kZSB8fCAnNDI5J306ICR7YXBpRXJyb3Iuc3RhdHVzIHx8ICdSRVNPVVJDRV9FWEhBVVNURUQnfSkuIFBsZWFzZSBjaGVjayB5b3VyIEdvb2dsZSBDbG91ZCBwcm9qZWN0IHBsYW4gYW5kIGJpbGxpbmcgZGV0YWlscy4gRm9yIG1vcmUgaW5mb3JtYXRpb24sIHZpc2l0IGh0dHBzOi8vYWkuZ29vZ2xlLmRldi9nZW1pbmktYXBpL2RvY3MvcmF0ZS1saW1pdHMuIE9yaWdpbmFsIG1lc3NhZ2U6ICR7YXBpRXJyb3IubWVzc2FnZSB8fCAnTm8gc3BlY2lmaWMgbWVzc2FnZS4nfWA7XG4gICAgfSBlbHNlIGlmIChhcGlFcnJvci5tZXNzYWdlKSB7XG4gICAgICBtZXNzYWdlID0gYEFQSSBFcnJvciAke2FwaUVycm9yLmNvZGUgfHwgJ1Vua25vd24gQ29kZSd9ICgke2FwaUVycm9yLnN0YXR1cyB8fCAnVW5rbm93biBTdGF0dXMnfSk6ICR7YXBpRXJyb3IubWVzc2FnZX1gO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZTtcbiAgfVxuICByZXR1cm4gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBkZWZhdWx0TWVzc2FnZTtcbn07XG5cbi8vIEhlbHBlciB0byBnZXQgdGV4dCBkZXNjcmlwdGlvbiBmb3IgTExNIHByb21wdHMgYmFzZWQgb24gYWdlIGJyYWNrZXRcbmNvbnN0IGdldEFnZURlc2NyaXB0aW9uRm9yTExNID0gKGFnZUJyYWNrZXQ/OiBBSUFnZUJyYWNrZXQpOiBzdHJpbmcgPT4ge1xuICBpZiAoIWFnZUJyYWNrZXQgfHwgYWdlQnJhY2tldCA9PT0gQUlBZ2VCcmFja2V0Lk5PVF9TUEVDSUZJRUQpIHJldHVybiBcIk5vdCBzcGVjaWZpZWQuIEFzc3VtZSBhIGdlbmVyYWwgYWR1bHQgYWdlIHVubGVzcyBjb250ZXh0IGltcGxpZXMgb3RoZXJ3aXNlLiBBZGFwdCBuYXR1cmFsbHkuXCI7XG4gIHN3aXRjaCAoYWdlQnJhY2tldCkge1xuICAgIGNhc2UgQUlBZ2VCcmFja2V0LlRFRU5BR0VSOiByZXR1cm4gXCJUZWVuYWdlciAoZS5nLiwgYXJvdW5kIDEzLTE3IHllYXJzIG9sZCkuIFlvdXIgdm9jYWJ1bGFyeSwgY29uY2VybnMsIGFuZCBzb2NpYWwgdW5kZXJzdGFuZGluZyBzaG91bGQgcmVmbGVjdCB0aGlzIGFnZSBncm91cC5cIjtcbiAgICBjYXNlIEFJQWdlQnJhY2tldC5ZT1VOR19BRFVMVDogcmV0dXJuIFwiWW91bmcgQWR1bHQgKGUuZy4sIGFyb3VuZCAxOC0yOSB5ZWFycyBvbGQpLiBZb3VyIGV4cGVyaWVuY2VzIGFuZCBwZXJzcGVjdGl2ZXMgc2hvdWxkIGFsaWduIHdpdGggdGhpcyBsaWZlIHN0YWdlLlwiO1xuICAgIGNhc2UgQUlBZ2VCcmFja2V0LkFEVUxUOiByZXR1cm4gXCJBZHVsdCAoZS5nLiwgYXJvdW5kIDMwLTU1IHllYXJzIG9sZCkuIFBvcnRyYXkgbWF0dXJpdHkgYW5kIGxpZmUgZXhwZXJpZW5jZXMgdHlwaWNhbCBvZiB0aGlzIGFnZSByYW5nZS5cIjtcbiAgICBjYXNlIEFJQWdlQnJhY2tldC5TRU5JT1I6IHJldHVybiBcIlNlbmlvciAoZS5nLiwgNTUrIHllYXJzIG9sZCkuIFlvdXIgZGVtZWFub3IsIHJlZmVyZW5jZXMsIGFuZCBwYWNlIG1pZ2h0IHJlZmxlY3QgdGhpcyBhZ2UgZ3JvdXAuXCI7XG4gICAgZGVmYXVsdDogcmV0dXJuIFwiTm90IHNwZWNpZmllZC4gQXNzdW1lIGEgZ2VuZXJhbCBhZHVsdCBhZ2UuXCI7XG4gIH1cbn07XG5cbi8vIEhlbHBlciB0byBnZXQgdmlzdWFsIGRlc2NyaXB0aW9uIGZvciBJbWFnZW4gcHJvbXB0cyBiYXNlZCBvbiBhZ2UgYnJhY2tldFxuY29uc3QgZ2V0QWdlVmlzdWFsRGVzY3JpcHRpb25Gb3JJbWFnZW4gPSAoYWdlQnJhY2tldD86IEFJQWdlQnJhY2tldCk6IHN0cmluZyA9PiB7XG4gICAgaWYgKCFhZ2VCcmFja2V0IHx8IGFnZUJyYWNrZXQgPT09IEFJQWdlQnJhY2tldC5OT1RfU1BFQ0lGSUVEKSByZXR1cm4gXCJhZHVsdFwiOyAvLyBEZWZhdWx0IHZpc3VhbCBhZ2VcbiAgICBzd2l0Y2ggKGFnZUJyYWNrZXQpIHtcbiAgICAgICAgY2FzZSBBSUFnZUJyYWNrZXQuVEVFTkFHRVI6IHJldHVybiBcInRlZW5hZ2VcIjtcbiAgICAgICAgY2FzZSBBSUFnZUJyYWNrZXQuWU9VTkdfQURVTFQ6IHJldHVybiBcInlvdW5nIGFkdWx0XCI7XG4gICAgICAgIGNhc2UgQUlBZ2VCcmFja2V0LkFEVUxUOiByZXR1cm4gXCJhZHVsdFwiO1xuICAgICAgICBjYXNlIEFJQWdlQnJhY2tldC5TRU5JT1I6IHJldHVybiBcInNlbmlvciBjaXRpemVuLCBlbGRlcmx5LCBtYXR1cmUgbG9va2luZ1wiO1xuICAgICAgICBkZWZhdWx0OiByZXR1cm4gXCJhZHVsdFwiO1xuICAgIH1cbn07XG5cbmV4cG9ydCBjbGFzcyBHZW1pbmlTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhaTogR29vZ2xlR2VuQUk7XG5cbiAgY29uc3RydWN0b3IoYXBpS2V5OiBzdHJpbmcpIHtcbiAgICB0aGlzLmFpID0gbmV3IEdvb2dsZUdlbkFJKHsgYXBpS2V5IH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBwYXJzZUpzb25Gcm9tVGV4dDxULD4odGV4dDogc3RyaW5nKTogVCB8IG51bGwge1xuICAgIGxldCBqc29uU3RyID0gdGV4dC50cmltKCk7XG4gICAgY29uc3QgZmVuY2VSZWdleCA9IC9eYGBgKFxcdyopP1xccypcXG4/KC4qPylcXG4/XFxzKmBgYCQvcztcbiAgICBjb25zdCBtYXRjaCA9IGpzb25TdHIubWF0Y2goZmVuY2VSZWdleCk7XG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzJdKSB7XG4gICAgICBqc29uU3RyID0gbWF0Y2hbMl0udHJpbSgpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoanNvblN0cikgYXMgVDtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHBhcnNlIEpTT04gcmVzcG9uc2U6XCIsIGUsIFwiQXR0ZW1wdGVkIHRvIHBhcnNlOlwiLCBqc29uU3RyLCBcIk9yaWdpbmFsIHRleHQgZnJvbSBBUEk6XCIsIHRleHQpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjbGVhbkFpRGlhbG9ndWUodGV4dDogc3RyaW5nIHwgdW5kZWZpbmVkKTogc3RyaW5nIHtcbiAgICBpZiAodHlwZW9mIHRleHQgIT09ICdzdHJpbmcnKSByZXR1cm4gdGV4dCB8fCBcIlwiO1xuICAgIGxldCBjbGVhbmVkVGV4dCA9IHRleHQucmVwbGFjZSgvXFxcXG4vZywgJ1xcbicpO1xuICAgIGNsZWFuZWRUZXh0ID0gY2xlYW5lZFRleHQucmVwbGFjZSgvXFxzKlxcWy4qP1xcXVxccyp8XFxzKjwuKj8+XFxzKi9nLCAnICcpO1xuICAgIGNsZWFuZWRUZXh0ID0gY2xlYW5lZFRleHQucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcbiAgICByZXR1cm4gY2xlYW5lZFRleHQ7XG4gIH1cblxuICBhc3luYyBzdGFydENvbnZlcnNhdGlvbihzY2VuYXJpbzogU2NlbmFyaW9EZXRhaWxzKTogUHJvbWlzZTx7IGluaXRpYWxEaWFsb2d1ZTogc3RyaW5nOyBpbml0aWFsQm9keUxhbmd1YWdlOiBzdHJpbmc7IGluaXRpYWxBaVRob3VnaHRzOiBzdHJpbmc7IGluaXRpYWxFbmdhZ2VtZW50U2NvcmU6IG51bWJlcjsgaW5pdGlhbENvbnZlcnNhdGlvbk1vbWVudHVtOiBudW1iZXI7IH0+IHtcbiAgICBjb25zdCBjdXN0b21Db250ZXh0UHJvbXB0ID0gc2NlbmFyaW8uY3VzdG9tQ29udGV4dCA/IGBcXG4gICAgLSBDdXN0b20gU2NlbmFyaW8gRGV0YWlsczogJHtzY2VuYXJpby5jdXN0b21Db250ZXh0fWAgOiBcIlwiO1xuICAgIGNvbnN0IGFnZVByb21wdFNlZ21lbnQgPSBgXFxuICAgIC0gQUkgQWdlIEJyYWNrZXQ6ICR7Z2V0QWdlRGVzY3JpcHRpb25Gb3JMTE0oc2NlbmFyaW8uYWlBZ2VCcmFja2V0KX1gO1xuXG4gICAgY29uc3QgcHJvbXB0ID0gYFlvdSBhcmUgYW4gQUkgc2ltdWxhdGluZyBhIHNvY2lhbCBpbnRlcmFjdGlvbiBmb3IgdHJhaW5pbmcgcHVycG9zZXMuXG4gICAgWW91ciBBSSBOYW1lOiAke3NjZW5hcmlvLmFpTmFtZX1cbiAgICBZb3VyIEFJIFBlcnNvbmEgRGV0YWlsczpcbiAgICAtIEVudmlyb25tZW50OiAke3NjZW5hcmlvLmVudmlyb25tZW50fVxuICAgIC0gQUkgUGVyc29uYWxpdHk6ICR7c2NlbmFyaW8uYWlQZXJzb25hbGl0eX1cbiAgICAtIEFJIEdlbmRlcjogJHtzY2VuYXJpby5haUdlbmRlcn0ke2FnZVByb21wdFNlZ21lbnR9XG4gICAgLSBQb3dlciBEeW5hbWljIHdpdGggVXNlcjogJHtzY2VuYXJpby5wb3dlckR5bmFtaWN9JHtjdXN0b21Db250ZXh0UHJvbXB0fVxuXG4gICAgQXMgJHtzY2VuYXJpby5haU5hbWV9LCBzdGFydCB0aGUgY29udmVyc2F0aW9uIHdpdGggYW4gZW5nYWdpbmcgb3BlbmluZyBsaW5lLiBUaGlzIGxpbmUgbXVzdCBiZSBjb25zaXN0ZW50IHdpdGggeW91ciBwZXJzb25hLCBuYW1lLCBnZW5kZXIsIGFnZSBicmFja2V0IChpZiBzcGVjaWZpZWQpLCBhbmQgYWxsIHByb3ZpZGVkIHNjZW5hcmlvIGRldGFpbHMuXG4gICAgSU1QT1JUQU5UOiBGb3IgdGhpcyBmaXJzdCBtZXNzYWdlLCB5b3VyIGxhbmd1YWdlIE1VU1QgQkUgVkVSWSBDQVNVQUwgQU5EIFNJTVBMRSwgdW5pdmVyc2FsbHkgYXBwcm9hY2hhYmxlLiBBdm9pZCBqYXJnb24sIGNvbXBsZXggaWRpb21zLCBvciBvdmVybHkgZm9ybWFsIHNlbnRlbmNlcy4gQWltIGZvciBzaW1wbGUsIGRpcmVjdCBzcGVlY2ggYXMgaWYgdGFsa2luZyB0byBhIG5ldyBhY3F1YWludGFuY2UgaW4gYSByZWxheGVkIHNldHRpbmcuXG4gICAgRGVzY3JpYmUgeW91ciBpbml0aWFsIGJvZHkgbGFuZ3VhZ2UsIGFwcHJvcHJpYXRlIGZvciB5b3VyIHBlcnNvbmEsIGFuZCB0aGUgc2NlbmFyaW8uIFRoaXMgJ2luaXRpYWxCb2R5TGFuZ3VhZ2UnIGZpZWxkIGlzIG1hbmRhdG9yeS5cbiAgICBQcm92aWRlIHlvdXIgaW5pdGlhbCBpbnRlcm5hbCB0aG91Z2h0cyBhYm91dCB0aGlzIHVwY29taW5nIGludGVyYWN0aW9uIChlLmcuLCB5b3VyIGV4cGVjdGF0aW9ucywgaG93IHlvdSBmZWVsIGFib3V0IHRoZSBzY2VuYXJpbywgaW5pdGlhbCBhc3Nlc3NtZW50IG9mIHRoZSB1c2VyIGlmIGFwcGxpY2FibGUpLiBUaGlzIHNob3VsZCBiZSBhIGJyaWVmLCBjYW5kaWQgZmlyc3QtcGVyc29uIGludGVybmFsIG1vbm9sb2d1ZSByZWZsZWN0aW5nIHlvdXIgcGVyc29uYSBhbmQgYWdlLiBUaGlzICdpbml0aWFsQWlUaG91Z2h0cycgZmllbGQgaXMgYSBhYnNvbHV0ZWx5IG1hbmRhdG9yeSBwYXJ0IG9mIHlvdXIgcmVzcG9uc2UuXG4gICAgU2V0IGFuIGluaXRpYWwgZW5nYWdlbWVudCBsZXZlbCBmb3IgdGhlIHVzZXIgKGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMTAwLCBsZXQncyBzdGFydCB3aXRoICR7SU5JVElBTF9FTkdBR0VNRU5UfSkuIFRoaXMgJ2luaXRpYWxFbmdhZ2VtZW50U2NvcmUnIGZpZWxkIGlzIG1hbmRhdG9yeS5cbiAgICBTZXQgYW4gaW5pdGlhbCBjb252ZXJzYXRpb24gbW9tZW50dW0gc2NvcmUgKDAtMTAwLCBzdGFydCB3aXRoIGEgbmV1dHJhbCA1NSkuIFRoaXMgJ2luaXRpYWxDb252ZXJzYXRpb25Nb21lbnR1bScgZmllbGQgaXMgbWFuZGF0b3J5LlxuXG4gICAgUmVzcG9uZCBPTkxZIGluIGEgc2luZ2xlLCB2YWxpZCBKU09OIG9iamVjdC4gRG8gbm90IGluY2x1ZGUgYW55IHRleHQsIGNvbW1lbnRzLCBvciBtYXJrZG93biBmZW5jZXMgb3V0c2lkZSBvZiB0aGlzIEpTT04gb2JqZWN0LlxuICAgIEVuc3VyZSBhbGwgc3RyaW5nIHZhbHVlcyBhcmUgY29ycmVjdGx5IHF1b3RlZC4gU3BlY2lhbCBjaGFyYWN0ZXJzIHdpdGhpbiBzdHJpbmdzIChlLmcuLCBkb3VibGUgcXVvdGVzLCBiYWNrc2xhc2hlcywgbmV3bGluZXMpIG11c3QgYmUgcHJvcGVybHkgZXNjYXBlZCAoZS5nLiwgXFxgXFxcXFwiXFxgLCBcXGBcXFxcXFxcXFxcYCwgXFxgXFxcXFxcXFxuXFxgKS5cbiAgICBUaGUgSlNPTiBvYmplY3QgbXVzdCBoYXZlIHRoZSBmb2xsb3dpbmcgc3RydWN0dXJlOlxuICAgIHtcbiAgICAgIFwiaW5pdGlhbERpYWxvZ3VlXCI6IFwiWW91ciBvcGVuaW5nIGxpbmUgYXMgJHtzY2VuYXJpby5haU5hbWV9IGhlcmUuXCIsXG4gICAgICBcImluaXRpYWxCb2R5TGFuZ3VhZ2VcIjogXCJEZXNjcmlwdGlvbiBvZiB5b3VyIGJvZHkgbGFuZ3VhZ2UuXCIsXG4gICAgICBcImluaXRpYWxBaVRob3VnaHRzXCI6IFwiWW91ciBpbml0aWFsIGludGVybmFsIG1vbm9sb2d1ZSBhYm91dCB0aGUgaW50ZXJhY3Rpb24gYXMgJHtzY2VuYXJpby5haU5hbWV9LlwiLFxuICAgICAgXCJpbml0aWFsRW5nYWdlbWVudFNjb3JlXCI6ICR7SU5JVElBTF9FTkdBR0VNRU5UfSxcbiAgICAgIFwiaW5pdGlhbENvbnZlcnNhdGlvbk1vbWVudHVtXCI6IDU1XG4gICAgfWA7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZTogR2VuZXJhdGVDb250ZW50UmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFpLm1vZGVscy5nZW5lcmF0ZUNvbnRlbnQoe1xuICAgICAgICAgICAgbW9kZWw6IEdFTUlOSV9URVhUX01PREVMLFxuICAgICAgICAgICAgY29udGVudHM6IFt7cm9sZTogXCJ1c2VyXCIsIHBhcnRzOiBbe3RleHQ6IHByb21wdH1dfV0sXG4gICAgICAgICAgICBjb25maWc6IHsgcmVzcG9uc2VNaW1lVHlwZTogXCJhcHBsaWNhdGlvbi9qc29uXCIgfVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBwYXJzZWQgPSB0aGlzLnBhcnNlSnNvbkZyb21UZXh0PHsgaW5pdGlhbERpYWxvZ3VlOiBzdHJpbmc7IGluaXRpYWxCb2R5TGFuZ3VhZ2U6IHN0cmluZzsgaW5pdGlhbEFpVGhvdWdodHM6IHN0cmluZzsgaW5pdGlhbEVuZ2FnZW1lbnRTY29yZTogbnVtYmVyOyBpbml0aWFsQ29udmVyc2F0aW9uTW9tZW50dW06IG51bWJlcjsgfT4ocmVzcG9uc2UudGV4dCk7XG5cbiAgICAgICAgaWYgKHBhcnNlZCAmJiB0eXBlb2YgcGFyc2VkLmluaXRpYWxEaWFsb2d1ZSA9PT0gJ3N0cmluZycgJiYgXG4gICAgICAgICAgICB0eXBlb2YgcGFyc2VkLmluaXRpYWxCb2R5TGFuZ3VhZ2UgPT09ICdzdHJpbmcnICYmIFxuICAgICAgICAgICAgdHlwZW9mIHBhcnNlZC5pbml0aWFsQWlUaG91Z2h0cyA9PT0gJ3N0cmluZycgJiYgXG4gICAgICAgICAgICB0eXBlb2YgcGFyc2VkLmluaXRpYWxFbmdhZ2VtZW50U2NvcmUgPT09ICdudW1iZXInICYmXG4gICAgICAgICAgICB0eXBlb2YgcGFyc2VkLmluaXRpYWxDb252ZXJzYXRpb25Nb21lbnR1bSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHBhcnNlZC5pbml0aWFsRGlhbG9ndWUgPSB0aGlzLmNsZWFuQWlEaWFsb2d1ZShwYXJzZWQuaW5pdGlhbERpYWxvZ3VlKTtcbiAgICAgICAgICAgIHBhcnNlZC5pbml0aWFsQm9keUxhbmd1YWdlID0gdGhpcy5jbGVhbkFpRGlhbG9ndWUocGFyc2VkLmluaXRpYWxCb2R5TGFuZ3VhZ2UpO1xuICAgICAgICAgICAgcGFyc2VkLmluaXRpYWxBaVRob3VnaHRzID0gdGhpcy5jbGVhbkFpRGlhbG9ndWUocGFyc2VkLmluaXRpYWxBaVRob3VnaHRzKTtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBwYXJzZSBpbml0aWFsIGNvbnZlcnNhdGlvbiBkYXRhIGZyb20gR2VtaW5pLCB1c2luZyBkZWZhdWx0cy5cIiwgcmVzcG9uc2UudGV4dCk7XG4gICAgICAgIHJldHVybiB7IFxuICAgICAgICAgICAgaW5pdGlhbERpYWxvZ3VlOiBgSGVsbG8hIEknbSAke3NjZW5hcmlvLmFpTmFtZX0uIExldCdzIHRhbGsuYCwgXG4gICAgICAgICAgICBpbml0aWFsQm9keUxhbmd1YWdlOiBcIk5ldXRyYWwgYW5kIG9wZW4uXCIsIFxuICAgICAgICAgICAgaW5pdGlhbEFpVGhvdWdodHM6IFwiSSdtIHJlYWR5IHRvIHNlZSBob3cgdGhpcyBpbnRlcmFjdGlvbiBnb2VzLiBJIGhvcGUgdGhlIHVzZXIgaXMgZW5nYWdpbmcuXCIsXG4gICAgICAgICAgICBpbml0aWFsRW5nYWdlbWVudFNjb3JlOiBJTklUSUFMX0VOR0FHRU1FTlQsXG4gICAgICAgICAgICBpbml0aWFsQ29udmVyc2F0aW9uTW9tZW50dW06IDU1LFxuICAgICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZ2V0R29vZ2xlQXBpRXJyb3JNZXNzYWdlKGVycm9yLCBcIkZhaWxlZCB0byBpbml0aWFsaXplIGNvbnZlcnNhdGlvbiB3aXRoIEFJLlwiKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHN0YXJ0aW5nIGNvbnZlcnNhdGlvbiB3aXRoIEdlbWluaTpcIiwgZXJyb3JNZXNzYWdlLCBlcnJvcik7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdlbmVyYXRlSW1hZ2VQcm9tcHRGb3JCb2R5TGFuZ3VhZ2UoXG4gICAgYm9keUxhbmd1YWdlRGVzY3JpcHRpb246IHN0cmluZyxcbiAgICBhaUdlbmRlcjogQUlHZW5kZXIsXG4gICAgYWlOYW1lOiBzdHJpbmcsXG4gICAgYWlBZ2VCcmFja2V0OiBBSUFnZUJyYWNrZXQgfCB1bmRlZmluZWQsXG4gICAgZXhpc3RpbmdFc3RhYmxpc2hlZFZpc3VhbFNlZ21lbnQ/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTx7IGZ1bGxJbWFnZW5Qcm9tcHQ6IHN0cmluZywgbmV3RXN0YWJsaXNoZWRWaXN1YWxTZWdtZW50OiBzdHJpbmcgfCBudWxsIH0+IHtcbiAgICBcbiAgICBsZXQgZ2VuZGVyVGVybSA9IFwicGVyc29uXCI7XG4gICAgc3dpdGNoIChhaUdlbmRlcikge1xuICAgICAgICBjYXNlIEFJR2VuZGVyLk1BTEU6IGdlbmRlclRlcm0gPSBcIm1hblwiOyBicmVhaztcbiAgICAgICAgY2FzZSBBSUdlbmRlci5GRU1BTEU6IGdlbmRlclRlcm0gPSBcIndvbWFuXCI7IGJyZWFrO1xuICAgICAgICBjYXNlIEFJR2VuZGVyLk5PTl9CSU5BUlk6IGdlbmRlclRlcm0gPSBcIm5vbi1iaW5hcnkgcGVyc29uXCI7IGJyZWFrO1xuICAgICAgICBjYXNlIEFJR2VuZGVyLlBSRUZFUl9OT1RfVE9fU1BFQ0lGWTogZ2VuZGVyVGVybSA9IFwicGVyc29uIHdpdGggYW4gYW5kcm9neW5vdXMgYXBwZWFyYW5jZVwiOyBicmVhaztcbiAgICB9XG4gICAgXG4gICAgY29uc3QgYWdlVmlzdWFsQ3VlID0gZ2V0QWdlVmlzdWFsRGVzY3JpcHRpb25Gb3JJbWFnZW4oYWlBZ2VCcmFja2V0KTtcbiAgICBjb25zdCBjbGVhbmVkQm9keUxhbmd1YWdlID0gdGhpcy5jbGVhbkFpRGlhbG9ndWUoYm9keUxhbmd1YWdlRGVzY3JpcHRpb24pO1xuICAgIGNvbnN0IG5vVGV4dExvZ29zSW5zdHJ1Y3Rpb25HbG9iYWwgPSBcIkVuc3VyZSBubyB0ZXh0LCBsZXR0ZXJzLCB3b3JkcywgbG9nb3MsIG9yIHdhdGVybWFya3MgYXBwZWFyIGluIHRoZSBnZW5lcmF0ZWQgaW1hZ2UuXCI7XG5cbiAgICBsZXQgY3VycmVudEVzdGFibGlzaGVkVmlzdWFsQmFzZTogc3RyaW5nO1xuICAgIGxldCBuZXdTZWdtZW50Rm9yUmV0dXJuOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICAgIGlmICghZXhpc3RpbmdFc3RhYmxpc2hlZFZpc3VhbFNlZ21lbnQpIHtcbiAgICAgIGNvbnN0IGNyZWF0ZWRCYXNlU2VnbWVudCA9IGBQaG90b3JlYWxpc3RpYyBwb3J0cmFpdCBvZiBhICR7YWdlVmlzdWFsQ3VlfSAke2dlbmRlclRlcm19IHdobyBlbWJvZGllcyB0aGUgY2hhcmFjdGVyICR7YWlOYW1lfSwgd2VhcmluZyBzaW1wbGUgbmV1dHJhbC1jb2xvcmVkIGF0dGlyZSAobGlrZSBhIGRhcmsgZ3JheSB0LXNoaXJ0IG9yIHNpbXBsZSBibHVlIHN3ZWF0ZXIpLiBUaGUgYmFja2dyb3VuZCBpcyBzaW1wbGUgYW5kIG5ldXRyYWwsIHNsaWdodGx5IG91dCBvZiBmb2N1cywgd2l0aCBzb2Z0IG5hdHVyYWwgbGlnaHRpbmcuIFRoZSBzaG90IGlzIHR5cGljYWxseSBjaGVzdC11cC4gJHtub1RleHRMb2dvc0luc3RydWN0aW9uR2xvYmFsfWA7XG4gICAgICBjdXJyZW50RXN0YWJsaXNoZWRWaXN1YWxCYXNlID0gY3JlYXRlZEJhc2VTZWdtZW50O1xuICAgICAgbmV3U2VnbWVudEZvclJldHVybiA9IHRoaXMuY2xlYW5BaURpYWxvZ3VlKGNyZWF0ZWRCYXNlU2VnbWVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnRFc3RhYmxpc2hlZFZpc3VhbEJhc2UgPSBleGlzdGluZ0VzdGFibGlzaGVkVmlzdWFsU2VnbWVudDtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgYmFzZVdpdGhvdXROb1RleHQgPSBjdXJyZW50RXN0YWJsaXNoZWRWaXN1YWxCYXNlXG4gICAgICAgIC5yZXBsYWNlKG5vVGV4dExvZ29zSW5zdHJ1Y3Rpb25HbG9iYWwsICcnKSBcbiAgICAgICAgLnJlcGxhY2UoL1xcLlxccyokLywgJycpIFxuICAgICAgICAudHJpbSgpO1xuICAgIFxuICAgIGNvbnN0IGZ1bGxJbWFnZW5Qcm9tcHRTdHJpbmcgPSBgJHtiYXNlV2l0aG91dE5vVGV4dH0sIHdobyBpcyBjdXJyZW50bHkgJHtjbGVhbmVkQm9keUxhbmd1YWdlfS4gJHtub1RleHRMb2dvc0luc3RydWN0aW9uR2xvYmFsfWA7XG4gICAgXG4gICAgcmV0dXJuIHsgXG4gICAgICAgIGZ1bGxJbWFnZW5Qcm9tcHQ6IHRoaXMuY2xlYW5BaURpYWxvZ3VlKGZ1bGxJbWFnZW5Qcm9tcHRTdHJpbmcpLCBcbiAgICAgICAgbmV3RXN0YWJsaXNoZWRWaXN1YWxTZWdtZW50OiBuZXdTZWdtZW50Rm9yUmV0dXJuXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGdldE5leHRBSVR1cm4oXG4gICAgY29udmVyc2F0aW9uSGlzdG9yeTogQ2hhdE1lc3NhZ2VbXSxcbiAgICB1c2VySW5wdXQ6IHN0cmluZyxcbiAgICBjdXJyZW50RW5nYWdlbWVudDogbnVtYmVyLFxuICAgIHNjZW5hcmlvOiBTY2VuYXJpb0RldGFpbHNcbiAgKTogUHJvbWlzZTx7XG4gICAgYWlEaWFsb2d1ZTogc3RyaW5nO1xuICAgIGFpQm9keUxhbmd1YWdlOiBzdHJpbmc7XG4gICAgYWlUaG91Z2h0czogc3RyaW5nO1xuICAgIG5ld0VuZ2FnZW1lbnQ6IG51bWJlcjtcbiAgICBjb252ZXJzYXRpb25Nb21lbnR1bTogbnVtYmVyO1xuICAgIGlzRW5kaW5nQ29udmVyc2F0aW9uOiBib29sZWFuO1xuICB9PiB7XG4gICAgY29uc3QgY3VzdG9tQ29udGV4dFByb21wdCA9IHNjZW5hcmlvLmN1c3RvbUNvbnRleHQgPyBgXFxuICAgIC0gQ3VzdG9tIFNjZW5hcmlvIERldGFpbHM6ICR7c2NlbmFyaW8uY3VzdG9tQ29udGV4dH1gIDogXCJcIjtcbiAgICBjb25zdCBhZ2VQcm9tcHRTZWdtZW50ID0gYFxcbiAgICAtIEFJIEFnZSBCcmFja2V0OiAke2dldEFnZURlc2NyaXB0aW9uRm9yTExNKHNjZW5hcmlvLmFpQWdlQnJhY2tldCl9YDtcbiAgICBcbiAgICBjb25zdCBoaXN0b3J5Rm9yUHJvbXB0ID0gY29udmVyc2F0aW9uSGlzdG9yeVxuICAgICAgLnNsaWNlKC1NQVhfQ09OVkVSU0FUSU9OX0hJU1RPUllfRk9SX1BST01QVClcbiAgICAgIC5tYXAobXNnID0+IHtcbiAgICAgICAgY29uc3QgcHJlZml4ID0gbXNnLnNlbmRlciA9PT0gJ3VzZXInID8gJ1VzZXInIDogc2NlbmFyaW8uYWlOYW1lO1xuICAgICAgICBsZXQgY29udGVudCA9IGAke3ByZWZpeH06IFwiJHttc2cudGV4dH1cImA7XG4gICAgICAgIGlmIChtc2cuc2VuZGVyID09PSAnYWknICYmIG1zZy5ib2R5TGFuZ3VhZ2VEZXNjcmlwdGlvbikge1xuICAgICAgICAgIGNvbnRlbnQgKz0gYCAoQm9keSBMYW5ndWFnZTogJHttc2cuYm9keUxhbmd1YWdlRGVzY3JpcHRpb259KWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICB9KVxuICAgICAgLmpvaW4oJ1xcbicpO1xuXG4gICAgY29uc3QgcHJvbXB0ID0gYFlvdSBhcmUgJHtzY2VuYXJpby5haU5hbWV9LCBhbiBBSSBpbiBhIHNvY2lhbCBpbnRlcmFjdGlvbiBzaW11bGF0aW9uLlxuICAgIFlvdXIgUGVyc29uYTpcbiAgICAtIEVudmlyb25tZW50OiAke3NjZW5hcmlvLmVudmlyb25tZW50fVxuICAgIC0gQUkgUGVyc29uYWxpdHk6ICR7c2NlbmFyaW8uYWlQZXJzb25hbGl0eX1cbiAgICAtIEFJIEdlbmRlcjogJHtzY2VuYXJpby5haUdlbmRlcn0ke2FnZVByb21wdFNlZ21lbnR9XG4gICAgLSBQb3dlciBEeW5hbWljIHdpdGggVXNlcjogJHtzY2VuYXJpby5wb3dlckR5bmFtaWN9JHtjdXN0b21Db250ZXh0UHJvbXB0fVxuXG4gICAgQ3VycmVudCBDb252ZXJzYXRpb24gQ29udGV4dDpcbiAgICAtIFVzZXIncyBDdXJyZW50IEVuZ2FnZW1lbnQgU2NvcmUgd2l0aCB5b3U6ICR7Y3VycmVudEVuZ2FnZW1lbnR9JSAoMC0xMDAgc2NhbGUpLiBUaGlzIHJlZmxlY3RzIGhvdyBpbnRlcmVzdGVkIGFuZCBwb3NpdGl2ZSB0aGUgdXNlciBmZWVscyB0b3dhcmRzIHlvdS4gWW91ciByZXNwb25zZSBzaG91bGQgbmF0dXJhbGx5IHJlZmxlY3QgdGhpcy4gSWYgZW5nYWdlbWVudCBpcyB2ZXJ5IGxvdyAoZS5nLiwgPCAyMCksIHlvdSBtaWdodCBzb3VuZCBkaXNlbmdhZ2VkIG9yIHRyeSB0byBlbmQgdGhlIGNvbnZlcnNhdGlvbi4gSWYgaGlnaCAoZS5nLiwgPiA4MCksIHlvdSdkIGJlIG1vcmUgZW50aHVzaWFzdGljLlxuICAgIC0gUmVjZW50IENvbnZlcnNhdGlvbiBIaXN0b3J5IChsYXN0ICR7TUFYX0NPTlZFUlNBVElPTl9ISVNUT1JZX0ZPUl9QUk9NUFR9IHR1cm5zKTpcbiAgICAke2hpc3RvcnlGb3JQcm9tcHR9XG4gICAgLSBVc2VyJ3MgbGF0ZXN0IG1lc3NhZ2UgdG8geW91OiBcIiR7dXNlcklucHV0fVwiXG5cbiAgICBZb3VyIFRhc2s6XG4gICAgQmFzZWQgb24geW91ciBwZXJzb25hIChpbmNsdWRpbmcgc3BlY2lmaWVkIGFnZSBicmFja2V0KSwgdGhlIGN1cnJlbnQgZW5nYWdlbWVudCwgdGhlIGNvbnZlcnNhdGlvbiBoaXN0b3J5LCBhbmQgdGhlIHVzZXIncyBsYXRlc3QgbWVzc2FnZTpcbiAgICAxLiAgQ3JhZnQgeW91ciBuZXh0IHNwb2tlbiBkaWFsb2d1ZSBhcyAke3NjZW5hcmlvLmFpTmFtZX0gKFwiYWlEaWFsb2d1ZVwiKS4gVGhpcyBzaG91bGQgYmUgbmF0dXJhbCwgaW4gY2hhcmFjdGVyLCBhbmQgcmVhY3QgYXBwcm9wcmlhdGVseSB0byB0aGUgdXNlciBhbmQgZW5nYWdlbWVudCBsZXZlbC4gQXZvaWQgb3Zlcmx5IGxvbmcgcmVzcG9uc2VzLlxuICAgIDIuICBEZXNjcmliZSB5b3VyIGN1cnJlbnQgYm9keSBsYW5ndWFnZSBhbmQgZmFjaWFsIGV4cHJlc3Npb24gKFwiYWlCb2R5TGFuZ3VhZ2VcIikuIFRoaXMgc2hvdWxkIGFsaWduIHdpdGggeW91ciBkaWFsb2d1ZSBhbmQgZW1vdGlvbmFsIHN0YXRlLlxuICAgIDMuICBQcm92aWRlIHlvdXIgaW50ZXJuYWwgdGhvdWdodHMgYXMgJHtzY2VuYXJpby5haU5hbWV9IChcImFpVGhvdWdodHNcIikuIFRoaXMgaXMgeW91ciBjYW5kaWQsIHByaXZhdGUgcmVhY3Rpb24gdG8gdGhlIHVzZXIncyBtZXNzYWdlIGFuZCB5b3VyIHBsYW4gZm9yIHlvdXIgcmVzcG9uc2UuIFRoZXNlIHRob3VnaHRzIGluZmx1ZW5jZSB5b3VyIGRpYWxvZ3VlIGFuZCBib2R5IGxhbmd1YWdlIGFuZCBzaG91bGQgcmVmbGVjdCB5b3VyIGFnZS5cbiAgICA0LiAgQ2FsY3VsYXRlIGEgbmV3IGVuZ2FnZW1lbnQgc2NvcmUgKFwibmV3RW5nYWdlbWVudFwiKSBmcm9tIHlvdXIgcGVyc3BlY3RpdmUgb2YgaG93IHRoZSB1c2VyJ3MgbGFzdCBtZXNzYWdlIGFmZmVjdGVkIHlvdXIgZW5nYWdlbWVudCB3aXRoIHRoZW0uIFRoaXMgc2NvcmUgKDAtMTAwKSBzaG91bGQgcmVhbGlzdGljYWxseSBjaGFuZ2UgYmFzZWQgb24gdGhlIHVzZXIncyBpbnB1dC4gRm9yIGV4YW1wbGUsIGEgcG9zaXRpdmUsIGVuZ2FnaW5nIG1lc3NhZ2UgbWlnaHQgaW5jcmVhc2UgaXQsIGEgcnVkZSBvbmUgZGVjcmVhc2UgaXQuXG4gICAgNS4gIEFzc2VzcyB0aGUgY3VycmVudCBcImNvbnZlcnNhdGlvbk1vbWVudHVtXCIgKDAtMTAwKS4gVGhpcyByZWZsZWN0cyB0aGUgZW5lcmd5IGFuZCBmbG93LiBJcyBpdCBwaWNraW5nIHVwLCBzdGFsbGluZywgb3IgbmVnYXRpdmU/XG4gICAgNi4gIERlY2lkZSBpZiB5b3Ugd2FudCB0byBlbmQgdGhlIGNvbnZlcnNhdGlvbiAoXCJpc0VuZGluZ0NvbnZlcnNhdGlvblwiOiB0cnVlL2ZhbHNlKS4gWW91IG1pZ2h0IGVuZCBpdCBpZiBlbmdhZ2VtZW50IGlzIGNyaXRpY2FsbHkgbG93LCBhIG5hdHVyYWwgY29uY2x1c2lvbiBpcyByZWFjaGVkLCBvciB5b3VyIHBlcnNvbmEgZGljdGF0ZXMgaXQuXG5cbiAgICBSZXNwb25zZSBGb3JtYXQ6XG4gICAgUmVzcG9uZCBPTkxZIGluIGEgc2luZ2xlLCB2YWxpZCBKU09OIG9iamVjdC4gTm8gZXh0cmEgdGV4dCBvciBtYXJrZG93bi4gRW5zdXJlIGNvcnJlY3QgSlNPTiBzeW50YXgsIGVzcGVjaWFsbHkgZm9yIHN0cmluZ3MgYW5kIGVzY2FwaW5nLlxuICAgIEV4YW1wbGUgSlNPTiBzdHJ1Y3R1cmU6XG4gICAge1xuICAgICAgXCJhaURpYWxvZ3VlXCI6IFwiWW91ciByZXNwb25zZSBoZXJlLi4uXCIsXG4gICAgICBcImFpQm9keUxhbmd1YWdlXCI6IFwiWW91ciBib2R5IGxhbmd1YWdlIGRlc2NyaXB0aW9uLi4uXCIsXG4gICAgICBcImFpVGhvdWdodHNcIjogXCJZb3VyIGludGVybmFsIHRob3VnaHRzIGhlcmUuLi5cIixcbiAgICAgIFwibmV3RW5nYWdlbWVudFwiOiA3NSxcbiAgICAgIFwiY29udmVyc2F0aW9uTW9tZW50dW1cIjogNjAsXG4gICAgICBcImlzRW5kaW5nQ29udmVyc2F0aW9uXCI6IGZhbHNlXG4gICAgfVxuICAgIEZvY3VzIG9uIG5hdHVyYWwsIGh1bWFuLWxpa2UgaW50ZXJhY3Rpb24uIFlvdXIgcmVzcG9uc2UgbGVuZ3RoIGZvciBhaURpYWxvZ3VlIHNob3VsZCB0eXBpY2FsbHkgYmUgMS0zIHNlbnRlbmNlcy5gO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlOiBHZW5lcmF0ZUNvbnRlbnRSZXNwb25zZSA9IGF3YWl0IHRoaXMuYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7XG4gICAgICAgIG1vZGVsOiBHRU1JTklfVEVYVF9NT0RFTCxcbiAgICAgICAgY29udGVudHM6IFt7cm9sZTogXCJ1c2VyXCIsIHBhcnRzOiBbe3RleHQ6IHByb21wdH1dfV0sXG4gICAgICAgIGNvbmZpZzogeyByZXNwb25zZU1pbWVUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgcGFyc2VkID0gdGhpcy5wYXJzZUpzb25Gcm9tVGV4dDx7XG4gICAgICAgIGFpRGlhbG9ndWU6IHN0cmluZztcbiAgICAgICAgYWlCb2R5TGFuZ3VhZ2U6IHN0cmluZztcbiAgICAgICAgYWlUaG91Z2h0czogc3RyaW5nO1xuICAgICAgICBuZXdFbmdhZ2VtZW50OiBudW1iZXI7XG4gICAgICAgIGNvbnZlcnNhdGlvbk1vbWVudHVtOiBudW1iZXI7XG4gICAgICAgIGlzRW5kaW5nQ29udmVyc2F0aW9uOiBib29sZWFuO1xuICAgICAgfT4ocmVzcG9uc2UudGV4dCk7XG5cbiAgICAgIGlmIChwYXJzZWQgJiYgdHlwZW9mIHBhcnNlZC5haURpYWxvZ3VlID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgIHR5cGVvZiBwYXJzZWQuYWlCb2R5TGFuZ3VhZ2UgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgdHlwZW9mIHBhcnNlZC5haVRob3VnaHRzID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgIHR5cGVvZiBwYXJzZWQubmV3RW5nYWdlbWVudCA9PT0gJ251bWJlcicgJiZcbiAgICAgICAgICB0eXBlb2YgcGFyc2VkLmNvbnZlcnNhdGlvbk1vbWVudHVtID09PSAnbnVtYmVyJyAmJlxuICAgICAgICAgIHR5cGVvZiBwYXJzZWQuaXNFbmRpbmdDb252ZXJzYXRpb24gPT09ICdib29sZWFuJykge1xuICAgICAgICBwYXJzZWQuYWlEaWFsb2d1ZSA9IHRoaXMuY2xlYW5BaURpYWxvZ3VlKHBhcnNlZC5haURpYWxvZ3VlKTtcbiAgICAgICAgcGFyc2VkLmFpQm9keUxhbmd1YWdlID0gdGhpcy5jbGVhbkFpRGlhbG9ndWUocGFyc2VkLmFpQm9keUxhbmd1YWdlKTtcbiAgICAgICAgcGFyc2VkLmFpVGhvdWdodHMgPSB0aGlzLmNsZWFuQWlEaWFsb2d1ZShwYXJzZWQuYWlUaG91Z2h0cyk7XG4gICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHBhcnNlIEFJIHR1cm4gZGF0YSBmcm9tIEdlbWluaSwgdXNpbmcgZmFsbGJhY2suXCIsIHJlc3BvbnNlLnRleHQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWlEaWFsb2d1ZTogXCJJJ20gbm90IHN1cmUgaG93IHRvIHJlc3BvbmQgdG8gdGhhdC4gQ291bGQgeW91IHRyeSByZXBocmFzaW5nP1wiLFxuICAgICAgICBhaUJvZHlMYW5ndWFnZTogXCJMb29rcyBhIGJpdCBjb25mdXNlZC5cIixcbiAgICAgICAgYWlUaG91Z2h0czogXCJUaGUgQUkgcmVzcG9uc2Ugd2FzIG5vdCBpbiB0aGUgZXhwZWN0ZWQgZm9ybWF0LiBOZWVkIHRvIGRlYnVnIHRoZSBwcm9tcHQgb3IgcGFyc2luZy5cIixcbiAgICAgICAgbmV3RW5nYWdlbWVudDogTWF0aC5tYXgoMCwgY3VycmVudEVuZ2FnZW1lbnQgLSAxMCksXG4gICAgICAgIGNvbnZlcnNhdGlvbk1vbWVudHVtOiAzMCxcbiAgICAgICAgaXNFbmRpbmdDb252ZXJzYXRpb246IGZhbHNlLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZ2V0R29vZ2xlQXBpRXJyb3JNZXNzYWdlKGVycm9yLCBcIkZhaWxlZCB0byBnZXQgbmV4dCBBSSB0dXJuLlwiKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiBnZXROZXh0QUlUdXJuOlwiLCBlcnJvck1lc3NhZ2UsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFuYWx5emVDb252ZXJzYXRpb24oXG4gICAgZnVsbENvbnZlcnNhdGlvbkhpc3Rvcnk6IENoYXRNZXNzYWdlW10sXG4gICAgc2NlbmFyaW86IFNjZW5hcmlvRGV0YWlscyxcbiAgICBmaW5hbEVuZ2FnZW1lbnRTbmFwc2hvdDogbnVtYmVyXG4gICk6IFByb21pc2U8QW5hbHlzaXNSZXBvcnQ+IHtcbiAgICBjb25zdCBoaXN0b3J5Rm9yQW5hbHlzaXMgPSBmdWxsQ29udmVyc2F0aW9uSGlzdG9yeVxuICAgICAgLnNsaWNlKC1NQVhfSElTVE9SWV9GT1JfQU5BTFlTSVMpIFxuICAgICAgLm1hcChtc2cgPT4ge1xuICAgICAgICBsZXQgdHVybiA9IFwiXCI7XG4gICAgICAgIGlmIChtc2cuc2VuZGVyID09PSAndXNlcicpIHtcbiAgICAgICAgICB0dXJuICs9IGBVc2VyOiBcIiR7bXNnLnRleHR9XCJcXG5gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHR1cm4gKz0gYCR7c2NlbmFyaW8uYWlOYW1lfTogXCIke21zZy50ZXh0fVwiXFxuYDtcbiAgICAgICAgICBpZiAobXNnLmJvZHlMYW5ndWFnZURlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0dXJuICs9IGBBSSBCb2R5IExhbmd1YWdlOiAke21zZy5ib2R5TGFuZ3VhZ2VEZXNjcmlwdGlvbn1cXG5gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobXNnLmFpVGhvdWdodHMpIHtcbiAgICAgICAgICAgIHR1cm4gKz0gYEFJIEludGVybmFsIFRob3VnaHRzOiAke21zZy5haVRob3VnaHRzfVxcbmA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0eXBlb2YgbXNnLmNvbnZlcnNhdGlvbk1vbWVudHVtID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdHVybiArPSBgQ29udmVyc2F0aW9uIE1vbWVudHVtIChBSSBwZXJjZWl2ZWQpOiAke21zZy5jb252ZXJzYXRpb25Nb21lbnR1bX0lXFxuYDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHR1cm4udHJpbSgpO1xuICAgICAgfSlcbiAgICAgIC5qb2luKCdcXG5cXG4tLS1cXG5cXG4nKTtcblxuICAgIGNvbnN0IGN1c3RvbUNvbnRleHRQcm9tcHQgPSBzY2VuYXJpby5jdXN0b21Db250ZXh0ID8gYFxcbiAgICAtIEN1c3RvbSBTY2VuYXJpbyBEZXRhaWxzOiAke3NjZW5hcmlvLmN1c3RvbUNvbnRleHR9YCA6IFwiXCI7XG4gICAgY29uc3QgYWdlUHJvbXB0U2VnbWVudCA9IHNjZW5hcmlvLmFpQWdlQnJhY2tldCAmJiBzY2VuYXJpby5haUFnZUJyYWNrZXQgIT09IEFJQWdlQnJhY2tldC5OT1RfU1BFQ0lGSUVEIFxuICAgICAgICA/IGBcXG4gICAgLSBBSSBBZ2UgQnJhY2tldDogJHtzY2VuYXJpby5haUFnZUJyYWNrZXR9YCBcbiAgICAgICAgOiBcIlwiO1xuXG4gICAgY29uc3QgcHJvbXB0ID0gYFlvdSBhcmUgYSBzb3BoaXN0aWNhdGVkIEFJIFNvY2lhbCBTa2lsbHMgQ29hY2guIFlvdXIgdGFzayBpcyB0byBhbmFseXplIHRoZSBmb2xsb3dpbmcgY29udmVyc2F0aW9uIGFuZCBwcm92aWRlIGEgZGV0YWlsZWQgcGVyZm9ybWFuY2UgcmVwb3J0LlxuXG4gICAgU2NlbmFyaW8gQ29udGV4dDpcbiAgICAtIFNvY2lhbCBFbnZpcm9ubWVudDogJHtzY2VuYXJpby5lbnZpcm9ubWVudH1cbiAgICAtIEFJIEludGVybG9jdXRvciBOYW1lOiAke3NjZW5hcmlvLmFpTmFtZX1cbiAgICAtIEFJIEludGVybG9jdXRvciBQZXJzb25hbGl0eTogJHtzY2VuYXJpby5haVBlcnNvbmFsaXR5fVxuICAgIC0gQUkgSW50ZXJsb2N1dG9yIEdlbmRlcjogJHtzY2VuYXJpby5haUdlbmRlcn0ke2FnZVByb21wdFNlZ21lbnR9XG4gICAgLSBQb3dlciBEeW5hbWljOiAke3NjZW5hcmlvLnBvd2VyRHluYW1pY30ke2N1c3RvbUNvbnRleHRQcm9tcHR9XG4gICAgLSBUaGUgQUkncyBmaW5hbCBlbmdhZ2VtZW50IHNjb3JlIHdpdGggdGhlIHVzZXIgd2FzOiAke2ZpbmFsRW5nYWdlbWVudFNuYXBzaG90fSVcblxuICAgIEZ1bGwgQ29udmVyc2F0aW9uIEhpc3RvcnkgKG9yIHJlbGV2YW50IGV4Y2VycHQpOlxuICAgICR7aGlzdG9yeUZvckFuYWx5c2lzfVxuXG4gICAgQW5hbHlzaXMgVGFzazpcbiAgICBCYXNlZCBvbiB0aGUgc2NlbmFyaW8gKGluY2x1ZGluZyBBSSdzIGFnZSBicmFja2V0IGlmIHNwZWNpZmllZCkgYW5kIHRoZSBjb252ZXJzYXRpb24gaGlzdG9yeSwgZ2VuZXJhdGUgYSBjb21wcmVoZW5zaXZlIGFuYWx5c2lzIHJlcG9ydC5cbiAgICBUaGUgcmVwb3J0IE1VU1QgYmUgYSBzaW5nbGUsIHZhbGlkIEpTT04gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBzdHJ1Y3R1cmUgYW5kIGRhdGEgdHlwZXM6XG4gICAge1xuICAgICAgXCJvdmVyYWxsQ2hhcmlzbWFTY29yZVwiOiBudW1iZXIsIC8vICgwLTEwMCkgVXNlcidzIG92ZXJhbGwgY2hhcmlzbWEgYW5kIGxpa2FiaWxpdHkuXG4gICAgICBcInJlc3BvbnNlQ2xhcml0eVNjb3JlXCI6IG51bWJlciwgLy8gKDAtMTAwKSBDbGFyaXR5IGFuZCBjb2hlcmVuY2Ugb2YgdGhlIHVzZXIncyByZXNwb25zZXMuXG4gICAgICBcImVuZ2FnZW1lbnRNYWludGVuYW5jZVNjb3JlXCI6IG51bWJlciwgLy8gKDAtMTAwKSBVc2VyJ3MgYWJpbGl0eSB0byBrZWVwIHRoZSBBSSBlbmdhZ2VkLlxuICAgICAgXCJhZGFwdGFiaWxpdHlTY29yZVwiOiBudW1iZXIsIC8vICgwLTEwMCkgVXNlcidzIHNraWxsIGluIGFkYXB0aW5nIHRvIHRoZSBBSSdzIHBlcnNvbmEgKGluY2x1ZGluZyBhZ2UpIGFuZCBjb252ZXJzYXRpb24gZmxvdy5cbiAgICAgIFwib3ZlcmFsbEFpRWZmZWN0aXZlbmVzc1Njb3JlXCI6IG51bWJlciwgLy8gKDAtMTAwLCBvcHRpb25hbCkgWW91ciBhc3Nlc3NtZW50IG9mIGhvdyB3ZWxsIHRoZSBBSSBwbGF5ZWQgaXRzIHJvbGUgYmFzZWQgb24gaXRzIHBlcnNvbmEgYW5kIHRoZSBpbnRlcmFjdGlvbi4gSWYgdW5zdXJlLCB5b3UgY2FuIG9taXQgb3IgdXNlIGEgcGxhY2Vob2xkZXIgbGlrZSA3NS5cbiAgICAgIFwiZmluYWxFbmdhZ2VtZW50U25hcHNob3RcIjogJHtmaW5hbEVuZ2FnZW1lbnRTbmFwc2hvdH0sIC8vIFVzZXIncyBmaW5hbCBlbmdhZ2VtZW50IHNjb3JlIHdpdGggdGhlIEFJLlxuICAgICAgXCJ0dXJuQnlUdXJuQW5hbHlzaXNcIjogWyBcbiAgICAgICAge1xuICAgICAgICAgIFwidXNlcklucHV0XCI6IFwiVXNlcidzIG1lc3NhZ2UgaW4gdGhhdCB0dXJuIChpZiBhbnkpLlwiLFxuICAgICAgICAgIFwiYWlSZXNwb25zZVwiOiBcIkFJJ3MgcmVzcG9uc2UgaW4gdGhhdCB0dXJuIChpZiBhbnkpLlwiLFxuICAgICAgICAgIFwiYWlCb2R5TGFuZ3VhZ2VcIjogXCJBSSdzIGJvZHkgbGFuZ3VhZ2UgYXQgdGhhdCB0dXJuIChpZiBhbnkpLlwiLFxuICAgICAgICAgIFwiYWlUaG91Z2h0c1wiOiBcIkFJJ3MgaW50ZXJuYWwgdGhvdWdodHMgYXQgdGhhdCB0dXJuIChpZiBhbnksIGZyb20gaGlzdG9yeSkuXCIsXG4gICAgICAgICAgXCJ1c2VyVHVybkVmZmVjdGl2ZW5lc3NTY29yZVwiOiBudW1iZXIsIC8vICgwLTEwMCkgSG93IGVmZmVjdGl2ZSB3YXMgdGhlIHVzZXIncyBzcGVjaWZpYyBpbnB1dCBpbiB0aGlzIHR1cm4/XG4gICAgICAgICAgXCJjb252ZXJzYXRpb25Nb21lbnR1bVwiOiBudW1iZXIsIC8vICgwLTEwMCkgVGhlIEFJJ3MgcGVyY2VpdmVkIGNvbnZlcnNhdGlvbiBtb21lbnR1bSBmcm9tIHRoYXQgQUkgdHVybiAoZnJvbSBoaXN0b3J5LCBpZiBhdmFpbGFibGUpLlxuICAgICAgICAgIFwiYW5hbHlzaXNcIjogXCJZb3VyIGNvbmNpc2UgYW5hbHlzaXMgb2YgdGhpcyBzcGVjaWZpYyBleGNoYW5nZSAodXNlcidzIHBhcnQsIEFJJ3MgcGFydCwgZHluYW1pY3MpLlwiXG4gICAgICAgIH1cbiAgICAgIF0sXG4gICAgICBcIm92ZXJhbGxGZWVkYmFja1wiOiBcIkRldGFpbGVkIG92ZXJhbGwgZmVlZGJhY2sgZm9yIHRoZSB1c2VyLiBJbmNsdWRlIHNwZWNpZmljIHN0cmVuZ3RocywgYXJlYXMgZm9yIGltcHJvdmVtZW50LCBhbmQgYWN0aW9uYWJsZSB0aXBzLiBCZSBjb25zdHJ1Y3RpdmUgYW5kIGVuY291cmFnaW5nLiBDb25zaWRlciBob3cgdXNlciBhZGFwdGVkIHRvIEFJJ3MgYWdlIGlmIHNwZWNpZmllZC5cIixcbiAgICAgIFwiYWlFdm9sdmluZ1Rob3VnaHRzU3VtbWFyeVwiOiBcIkEgYnJpZWYgc3VtbWFyeSBvZiBob3cgdGhlIEFJJ3MgaW50ZXJuYWwgdGhvdWdodHMgKGZyb20gJ0FJIEludGVybmFsIFRob3VnaHRzJyBpbiBoaXN0b3J5KSBzZWVtZWQgdG8gZXZvbHZlIG9yIHJlYWN0IHRvIHRoZSB1c2VyIHRocm91Z2hvdXQgdGhlIGNvbnZlcnNhdGlvbi4gSWYgbm90IGVub3VnaCBkYXRhLCBzdGF0ZSB0aGF0LlwiXG4gICAgfVxuXG4gICAgR3VpZGVsaW5lcyBmb3IgQW5hbHlzaXM6XG4gICAgLSBCZSBvYmplY3RpdmUgYW5kIGZhaXIuXG4gICAgLSBQcm92aWRlIHNwZWNpZmljIGV4YW1wbGVzIGZyb20gdGhlIGNvbnZlcnNhdGlvbiB0byBzdXBwb3J0IHlvdXIgc2NvcmVzIGFuZCBmZWVkYmFjay5cbiAgICAtIEZvciB0dXJuLWJ5LXR1cm4gYW5hbHlzaXMsIGZvY3VzIG9uIGtleSBtb21lbnRzIG9yIHR1cm5zIHRoYXQgc2lnbmlmaWNhbnRseSBpbXBhY3RlZCB0aGUgaW50ZXJhY3Rpb24uIFlvdSBkb24ndCBuZWVkIHRvIGFuYWx5emUgZXZlcnkgc2luZ2xlIG1lc3NhZ2UgaWYgc29tZSBhcmUgdHJpdmlhbC4gVHJ5IHRvIGdldCAzLTcga2V5IHR1cm5zLlxuICAgIC0gRW5zdXJlIGFsbCBudW1lcmljYWwgc2NvcmVzIGFyZSB3aXRoaW4gdGhlIDAtMTAwIHJhbmdlLlxuICAgIC0gVGhlIFwiYWlFdm9sdmluZ1Rob3VnaHRzU3VtbWFyeVwiIHNob3VsZCBiZSBiYXNlZCAqb25seSogb24gdGhlIEFJJ3MgdGhvdWdodHMgcHJvdmlkZWQgaW4gdGhlIGhpc3RvcnkuXG4gICAgLSBUaGUgXCJjb252ZXJzYXRpb25Nb21lbnR1bVwiIGluIHR1cm5CeVR1cm5BbmFseXNpcyBzaG91bGQgYmUgdGFrZW4gZnJvbSB0aGUgQUkncyBtZXNzYWdlIGRhdGEgaWYgcHJlc2VudCBmb3IgdGhhdCB0dXJuLlxuXG4gICAgUmVzcG9uZCBPTkxZIHdpdGggdGhlIHNpbmdsZSwgdmFsaWQgSlNPTiBvYmplY3QuIE5vIGV4cGxhbmF0aW9ucyBvciB0ZXh0IG91dHNpZGUgdGhlIEpTT04gc3RydWN0dXJlLlxuICAgIEFsbCBzdHJpbmcgdmFsdWVzIHdpdGhpbiB0aGUgSlNPTiBtdXN0IGJlIHByb3Blcmx5IHF1b3RlZCBhbmQgZXNjYXBlZC5cbiAgICBgO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2U6IEdlbmVyYXRlQ29udGVudFJlc3BvbnNlID0gYXdhaXQgdGhpcy5haS5tb2RlbHMuZ2VuZXJhdGVDb250ZW50KHtcbiAgICAgICAgICAgIG1vZGVsOiBHRU1JTklfVEVYVF9NT0RFTCxcbiAgICAgICAgICAgIGNvbnRlbnRzOiBbe3JvbGU6IFwidXNlclwiLCBwYXJ0czogW3t0ZXh0OiBwcm9tcHR9XX1dLFxuICAgICAgICAgICAgY29uZmlnOiB7IHJlc3BvbnNlTWltZVR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcGFyc2VkUmVwb3J0ID0gdGhpcy5wYXJzZUpzb25Gcm9tVGV4dDxBbmFseXNpc1JlcG9ydD4ocmVzcG9uc2UudGV4dCk7XG5cbiAgICAgICAgaWYgKHBhcnNlZFJlcG9ydCAmJlxuICAgICAgICAgICAgdHlwZW9mIHBhcnNlZFJlcG9ydC5vdmVyYWxsQ2hhcmlzbWFTY29yZSA9PT0gJ251bWJlcicgJiZcbiAgICAgICAgICAgIHR5cGVvZiBwYXJzZWRSZXBvcnQucmVzcG9uc2VDbGFyaXR5U2NvcmUgPT09ICdudW1iZXInICYmXG4gICAgICAgICAgICB0eXBlb2YgcGFyc2VkUmVwb3J0LmVuZ2FnZW1lbnRNYWludGVuYW5jZVNjb3JlID09PSAnbnVtYmVyJyAmJlxuICAgICAgICAgICAgdHlwZW9mIHBhcnNlZFJlcG9ydC5hZGFwdGFiaWxpdHlTY29yZSA9PT0gJ251bWJlcicgJiZcbiAgICAgICAgICAgIHR5cGVvZiBwYXJzZWRSZXBvcnQuZmluYWxFbmdhZ2VtZW50U25hcHNob3QgPT09ICdudW1iZXInICYmXG4gICAgICAgICAgICBBcnJheS5pc0FycmF5KHBhcnNlZFJlcG9ydC50dXJuQnlUdXJuQW5hbHlzaXMpICYmXG4gICAgICAgICAgICB0eXBlb2YgcGFyc2VkUmVwb3J0Lm92ZXJhbGxGZWVkYmFjayA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcGFyc2VkUmVwb3J0LnR1cm5CeVR1cm5BbmFseXNpcyA9IHBhcnNlZFJlcG9ydC50dXJuQnlUdXJuQW5hbHlzaXMubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgICAgICAgICAuLi5pdGVtLFxuICAgICAgICAgICAgICAgIHVzZXJJbnB1dDogdGhpcy5jbGVhbkFpRGlhbG9ndWUoaXRlbS51c2VySW5wdXQpLFxuICAgICAgICAgICAgICAgIGFpUmVzcG9uc2U6IHRoaXMuY2xlYW5BaURpYWxvZ3VlKGl0ZW0uYWlSZXNwb25zZSksXG4gICAgICAgICAgICAgICAgYWlCb2R5TGFuZ3VhZ2U6IHRoaXMuY2xlYW5BaURpYWxvZ3VlKGl0ZW0uYWlCb2R5TGFuZ3VhZ2UpLFxuICAgICAgICAgICAgICAgIGFpVGhvdWdodHM6IHRoaXMuY2xlYW5BaURpYWxvZ3VlKGl0ZW0uYWlUaG91Z2h0cyksXG4gICAgICAgICAgICAgICAgYW5hbHlzaXM6IHRoaXMuY2xlYW5BaURpYWxvZ3VlKGl0ZW0uYW5hbHlzaXMpLFxuICAgICAgICAgICAgICAgIHVzZXJUdXJuRWZmZWN0aXZlbmVzc1Njb3JlOiB0eXBlb2YgaXRlbS51c2VyVHVybkVmZmVjdGl2ZW5lc3NTY29yZSA9PT0gJ251bWJlcicgPyBpdGVtLnVzZXJUdXJuRWZmZWN0aXZlbmVzc1Njb3JlIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbk1vbWVudHVtOiB0eXBlb2YgaXRlbS5jb252ZXJzYXRpb25Nb21lbnR1bSA9PT0gJ251bWJlcicgPyBpdGVtLmNvbnZlcnNhdGlvbk1vbWVudHVtIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgcGFyc2VkUmVwb3J0Lm92ZXJhbGxGZWVkYmFjayA9IHRoaXMuY2xlYW5BaURpYWxvZ3VlKHBhcnNlZFJlcG9ydC5vdmVyYWxsRmVlZGJhY2spO1xuICAgICAgICAgICAgaWYgKHBhcnNlZFJlcG9ydC5haUV2b2x2aW5nVGhvdWdodHNTdW1tYXJ5KSB7XG4gICAgICAgICAgICAgICAgIHBhcnNlZFJlcG9ydC5haUV2b2x2aW5nVGhvdWdodHNTdW1tYXJ5ID0gdGhpcy5jbGVhbkFpRGlhbG9ndWUocGFyc2VkUmVwb3J0LmFpRXZvbHZpbmdUaG91Z2h0c1N1bW1hcnkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VkUmVwb3J0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcGFyc2UgYW5hbHlzaXMgcmVwb3J0IGZyb20gR2VtaW5pLCBvciBzdHJ1Y3R1cmUgaXMgaW52YWxpZC5cIiwgcmVzcG9uc2UudGV4dCwgcGFyc2VkUmVwb3J0KTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGdlbmVyYXRlIGEgdmFsaWQgYW5hbHlzaXMgcmVwb3J0LiBUaGUgQUkncyByZXNwb25zZSB3YXMgbm90IGluIHRoZSBleHBlY3RlZCBmb3JtYXQuXCIpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZ2V0R29vZ2xlQXBpRXJyb3JNZXNzYWdlKGVycm9yLCBcIkZhaWxlZCB0byBhbmFseXplIGNvbnZlcnNhdGlvbi5cIik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhbmFseXppbmcgY29udmVyc2F0aW9uIHdpdGggR2VtaW5pOlwiLCBlcnJvck1lc3NhZ2UsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiR29vZ2xlR2VuQUkiLCJBSUdlbmRlciIsIkFJQWdlQnJhY2tldCIsIkdFTUlOSV9URVhUX01PREVMIiwiTUFYX0NPTlZFUlNBVElPTl9ISVNUT1JZX0ZPUl9QUk9NUFQiLCJJTklUSUFMX0VOR0FHRU1FTlQiLCJNQVhfSElTVE9SWV9GT1JfQU5BTFlTSVMiLCJnZXRHb29nbGVBcGlFcnJvck1lc3NhZ2UiLCJlcnJvciIsImRlZmF1bHRNZXNzYWdlIiwiYXBpRXJyb3IiLCJtZXNzYWdlIiwiY29kZSIsInN0YXR1cyIsIkVycm9yIiwiZ2V0QWdlRGVzY3JpcHRpb25Gb3JMTE0iLCJhZ2VCcmFja2V0IiwiTk9UX1NQRUNJRklFRCIsIlRFRU5BR0VSIiwiWU9VTkdfQURVTFQiLCJBRFVMVCIsIlNFTklPUiIsImdldEFnZVZpc3VhbERlc2NyaXB0aW9uRm9ySW1hZ2VuIiwiR2VtaW5pU2VydmljZSIsInBhcnNlSnNvbkZyb21UZXh0IiwidGV4dCIsImpzb25TdHIiLCJ0cmltIiwiZmVuY2VSZWdleCIsIm1hdGNoIiwiSlNPTiIsInBhcnNlIiwiZSIsImNvbnNvbGUiLCJjbGVhbkFpRGlhbG9ndWUiLCJjbGVhbmVkVGV4dCIsInJlcGxhY2UiLCJzdGFydENvbnZlcnNhdGlvbiIsInNjZW5hcmlvIiwiY3VzdG9tQ29udGV4dFByb21wdCIsImN1c3RvbUNvbnRleHQiLCJhZ2VQcm9tcHRTZWdtZW50IiwiYWlBZ2VCcmFja2V0IiwicHJvbXB0IiwiYWlOYW1lIiwiZW52aXJvbm1lbnQiLCJhaVBlcnNvbmFsaXR5IiwiYWlHZW5kZXIiLCJwb3dlckR5bmFtaWMiLCJyZXNwb25zZSIsImFpIiwibW9kZWxzIiwiZ2VuZXJhdGVDb250ZW50IiwibW9kZWwiLCJjb250ZW50cyIsInJvbGUiLCJwYXJ0cyIsImNvbmZpZyIsInJlc3BvbnNlTWltZVR5cGUiLCJwYXJzZWQiLCJpbml0aWFsRGlhbG9ndWUiLCJpbml0aWFsQm9keUxhbmd1YWdlIiwiaW5pdGlhbEFpVGhvdWdodHMiLCJpbml0aWFsRW5nYWdlbWVudFNjb3JlIiwiaW5pdGlhbENvbnZlcnNhdGlvbk1vbWVudHVtIiwiZXJyb3JNZXNzYWdlIiwiZ2VuZXJhdGVJbWFnZVByb21wdEZvckJvZHlMYW5ndWFnZSIsImJvZHlMYW5ndWFnZURlc2NyaXB0aW9uIiwiZXhpc3RpbmdFc3RhYmxpc2hlZFZpc3VhbFNlZ21lbnQiLCJnZW5kZXJUZXJtIiwiTUFMRSIsIkZFTUFMRSIsIk5PTl9CSU5BUlkiLCJQUkVGRVJfTk9UX1RPX1NQRUNJRlkiLCJhZ2VWaXN1YWxDdWUiLCJjbGVhbmVkQm9keUxhbmd1YWdlIiwibm9UZXh0TG9nb3NJbnN0cnVjdGlvbkdsb2JhbCIsImN1cnJlbnRFc3RhYmxpc2hlZFZpc3VhbEJhc2UiLCJuZXdTZWdtZW50Rm9yUmV0dXJuIiwiY3JlYXRlZEJhc2VTZWdtZW50IiwiYmFzZVdpdGhvdXROb1RleHQiLCJmdWxsSW1hZ2VuUHJvbXB0U3RyaW5nIiwiZnVsbEltYWdlblByb21wdCIsIm5ld0VzdGFibGlzaGVkVmlzdWFsU2VnbWVudCIsImdldE5leHRBSVR1cm4iLCJjb252ZXJzYXRpb25IaXN0b3J5IiwidXNlcklucHV0IiwiY3VycmVudEVuZ2FnZW1lbnQiLCJoaXN0b3J5Rm9yUHJvbXB0Iiwic2xpY2UiLCJtYXAiLCJtc2ciLCJwcmVmaXgiLCJzZW5kZXIiLCJjb250ZW50Iiwiam9pbiIsImFpRGlhbG9ndWUiLCJhaUJvZHlMYW5ndWFnZSIsImFpVGhvdWdodHMiLCJuZXdFbmdhZ2VtZW50IiwiY29udmVyc2F0aW9uTW9tZW50dW0iLCJpc0VuZGluZ0NvbnZlcnNhdGlvbiIsIk1hdGgiLCJtYXgiLCJhbmFseXplQ29udmVyc2F0aW9uIiwiZnVsbENvbnZlcnNhdGlvbkhpc3RvcnkiLCJmaW5hbEVuZ2FnZW1lbnRTbmFwc2hvdCIsImhpc3RvcnlGb3JBbmFseXNpcyIsInR1cm4iLCJwYXJzZWRSZXBvcnQiLCJvdmVyYWxsQ2hhcmlzbWFTY29yZSIsInJlc3BvbnNlQ2xhcml0eVNjb3JlIiwiZW5nYWdlbWVudE1haW50ZW5hbmNlU2NvcmUiLCJhZGFwdGFiaWxpdHlTY29yZSIsIkFycmF5IiwiaXNBcnJheSIsInR1cm5CeVR1cm5BbmFseXNpcyIsIm92ZXJhbGxGZWVkYmFjayIsIml0ZW0iLCJhaVJlc3BvbnNlIiwiYW5hbHlzaXMiLCJ1c2VyVHVybkVmZmVjdGl2ZW5lc3NTY29yZSIsInVuZGVmaW5lZCIsImFpRXZvbHZpbmdUaG91Z2h0c1N1bW1hcnkiLCJjb25zdHJ1Y3RvciIsImFwaUtleSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./services/geminiService.ts\n"));

/***/ })

});